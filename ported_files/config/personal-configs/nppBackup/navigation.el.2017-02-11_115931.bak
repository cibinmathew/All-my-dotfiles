(defun my-move-end-of-line-before-whitespace ()
  "Move to the last non-whitespace character in the current line."
  (move-end-of-line nil)
  (re-search-backward "^\\|[^[:space:]]")
  (forward-char)
  )
  
  
(defun smart-end-of-line ()
  "Move point to first non-whitespace character or beginning-of-line.

Move point to the last non-whitespace character on this line.
If point was already at that position, move point to end of line."
  (interactive)
  (let ((oldpos (point)))
(my-move-end-of-line-before-whitespace)
    (and (= oldpos (point))
         (end-of-line))))     
(global-set-key (kbd "C-e") 'smart-end-of-line)
